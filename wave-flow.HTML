<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>معرض Wave Flow</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Poppins:wght@700&display=swap" rel="stylesheet">
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<style>

    :root {
        --primary-blue: #1C2D43;
        --secondary-blue: #3E8DCF;
        --light-blue: #ffffff;
        --text-color-light: #E0E7FF;
        --bg-gradient: linear-gradient(145deg, #1C2D43 0%, #2A3C56 100%);
        --card-bg: rgba(255, 255, 255, 0.08);
        --card-border: rgba(255, 255, 255, 0.15);
        --glow-shadow: 0 0 15px rgba(62, 141, 207, 0.6);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: var(--bg-gradient);
        color: var(--text-color-light);
        min-height: 100vh;
        padding: 20px;
        direction: rtl; /* Important for RTL */
        font-family: 'Cairo', sans-serif;
        line-height: 1.7;
        position: relative;
        overflow-x: hidden; /* Prevent horizontal scroll on body */
        background-attachment: fixed;
    }


    #preloader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--bg-gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
    }

    #preloader.hidden {
        opacity: 0;
        visibility: hidden;
    }

    .preloader-spinner {
        border: 5px solid rgba(255, 255, 255, 0.2);
        border-top: 5px solid var(--secondary-blue);
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        text-align: center;
    }


    .section-title-header {
        text-align: center;
        margin-bottom: 60px;
        padding: 20px;
    }

    .section-title-header h2 {
        font-family: 'Poppins', sans-serif;
        font-size: 4rem;
        font-weight: 700;
        margin-bottom: 10px;
        color: var(--light-blue);
        text-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        position: relative;
        display: inline-block;
        transition: color 0.3s ease;
    }

    .section-title-header h2::after {
        content: '';
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
        width: 80%;
        height: 4px;
        background: var(--secondary-blue);
        border-radius: 5px;
        box-shadow: 0 0 10px var(--secondary-blue);
        transition: width 0.5s ease;
    }

    .section-title-header p {
        font-size: 1.25rem;
        max-width: 850px;
        margin: 30px auto 0;
        color: #A0C4FF;
    }


    .section-divider {
        display: flex;
        align-items: center;
        margin: 80px 0 50px;
        position: relative;
    }

    .divider-title {
        font-family: 'Cairo', sans-serif;
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--light-blue);
        padding: 0 20px;
        background: var(--primary-blue);
        z-index: 2;
        text-shadow: 0 0 10px rgba(179, 224, 255, 0.5);
    }

    .divider-line {
        position: absolute;
        width: 100%;
        height: 2px;
        background: linear-gradient(to right, transparent, var(--secondary-blue) 20%, var(--secondary-blue) 80%, transparent);
        box-shadow: 0 0 15px var(--secondary-blue);
        z-index: 1;
    }


    .carousel-container {
        position: relative;
        width: 100%;
        overflow: hidden;
        margin-bottom: 50px;
    }

    .carousel-wrapper {
        display: flex;
        flex-wrap: nowrap;
        gap: 25px;
        padding: 20px;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
        -ms-overflow-style: none; /* For IE and Edge */
        scrollbar-width: none; /* For Firefox */
        cursor: grab;
        justify-content: center; /* This helps visually, but JS handles true centering */
    }

    .carousel-wrapper:active {
        cursor: grabbing;
    }

    .carousel-wrapper::-webkit-scrollbar {
        display: none; /* For Chrome, Safari, and Opera */
    }

    .gallery-item {
        flex: 0 0 auto;
        width: 320px;
        height: 320px;
        position: relative;
        border-radius: 20px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.4s ease, box-shadow 0.4s ease, opacity 0.4s ease;
        background: var(--card-bg);
        border: 2px solid var(--card-border);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        scroll-snap-align: center;
        transform: perspective(1000px) scale(0.9);
        opacity: 0.6;
    }

    .gallery-item.active-item {
        transform: perspective(1000px) scale(1);
        opacity: 1;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.7), var(--glow-shadow);
    }

    .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s ease;
        filter: brightness(0.9);
    }

    .gallery-item:hover img {
        transform: scale(1.05);
        filter: brightness(1.1);
    }


    .carousel-nav-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid var(--card-border);
        color: var(--light-blue);
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 10;
        transition: all 0.3s ease;
        opacity: 0.8;
    }

    .carousel-nav-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        box-shadow: 0 0 15px var(--light-blue);
        transform: translateY(-50%) scale(1.1);
        opacity: 1;
    }
    /* Adjusted for RTL: prev is on the right, next is on the left */
    .prev-carousel-btn { right: 10px; }
    .next-carousel-btn { left: 10px; }


    .info-panel {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 15px;
        padding: 30px;
        margin: 20px auto 40px;
        max-width: 1000px;
        text-align: right;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }

    .info-panel h3 {
        font-size: 2rem;
        margin-bottom: 20px;
        color: var(--light-blue);
        text-shadow: 0 0 10px rgba(179, 224, 255, 0.5);
    }

    .info-panel p {
        font-size: 1.1rem;
        color: #a0c4ff;
    }


    .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s ease;
    }

    .lightbox.active {
        opacity: 1;
        visibility: visible;
    }

    .lightbox-content {
        position: relative;
        max-width: 90%;
        max-height: 85vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .lightbox-content img {
        max-width: 100%;
        max-height: 85vh;
        border-radius: 15px;
        box-shadow: 0 20px 80px rgba(0, 0, 0, 0.8);
        transform: scale(0.8);
        transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        border: 3px solid var(--secondary-blue);
        object-fit: contain;
    }

    .lightbox.active .lightbox-content img {
        transform: scale(1);
    }

    /* Spinner for lightbox loading */
    .lightbox-spinner {
        position: absolute;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid var(--secondary-blue);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        display: none; /* Hidden by default */
        z-index: 1002;
    }


    .close-btn, .nav-btn, .back-to-top {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: var(--light-blue);
        transition: all 0.3s ease;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        cursor: pointer;
        position: absolute;
        z-index: 1001;
        opacity: 0.8;
    }

    .close-btn:hover, .nav-btn:hover, .back-to-top:hover {
        background: rgba(255, 255, 255, 0.2);
        box-shadow: 0 0 20px var(--secondary-blue);
        transform: scale(1.1);
        opacity: 1;
    }

    .close-btn {
        top: 20px;
        right: 20px;
    }

    /* Lightbox navigation buttons - Adjusted for RTL */
    .nav-btn.prev-btn {
        right: 20px; /* 'Previous' button is on the right in RTL */
        top: 50%;
        transform: translateY(-50%);
    }
    .nav-btn.next-btn {
        left: 20px; /* 'Next' button is on the left in RTL */
        top: 50%;
        transform: translateY(-50%);
    }

    .back-to-top {
        bottom: 30px;
        left: 30px;
        width: 55px;
        height: 55px;
        font-size: 2rem;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s, visibility 0.4s;
    }

    .back-to-top.show {
        opacity: 1;
        visibility: visible;
    }


    @media (max-width: 992px) {
        .gallery-item {
            width: 280px;
            height: 280px;
        }
    }
    @media (max-width: 768px) {
        .section-title-header h2 { font-size: 3rem; }
        .intro { font-size: 1.1rem; }
        .divider-title { font-size: 2rem; }
        .carousel-wrapper {
            padding: 10px;
            gap: 15px;
        }
        .gallery-item {
            width: 250px;
            height: 250px;
        }
        .carousel-nav-btn {
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
        }
        .close-btn { top: 10px; right: 10px; width: 40px; height: 40px; font-size: 1.2rem; }
        .nav-btn.prev-btn { right: 10px; width: 40px; height: 40px; font-size: 1.2rem; }
        .nav-btn.next-btn { left: 10px; width: 40px; height: 40px; font-size: 1.2rem; }
    }

    @media (max-width: 480px) {
        body { padding: 10px; }
        .section-title-header h2 { font-size: 2.5rem; }
        .section-title-header h2::after { bottom: -10px; }
        .divider-title { font-size: 1.8rem; padding: 0 10px; }
        .gallery-item {
            width: 85%; /* Make it responsive to screen width */
            max-width: 300px; /* But don't exceed a reasonable max */
            height: 300px;
        }
        .carousel-container {
            padding-bottom: 20px;
        }
        .carousel-nav-btn { display: none; } /* إخفاء أزرار التنقل الرئيسية في العرض الصغير */
    }
</style>
</head>
<body>

<div id="preloader">
    <div class="preloader-spinner"></div>
</div>

<div class="container">
    <header class="section-title-header">
        <h2 data-aos="fade-down" data-aos-duration="1200">Wave Flow</h2>
        <p class="intro" data-aos="fade-up" data-aos-delay="300">
            نقدم لكم معرضاً لأعمالنا في التصميم، التصوير، وتطوير الهوية البصرية. رؤيتنا هي تحويل الأفكار إلى إبداعات بصرية لا تُنسى.
        </p>
    </header>

    <div class="carousel-container design-gallery">
        <div class="carousel-wrapper" id="design-carousel">
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="100"><img src="https://imagizer.imageshack.com/img922/7891/lmH7dS.png" alt="تصميم إبداعي" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="200"><img src="https://imagizer.imageshack.com/img923/8852/UG4kdA.jpg" alt="عمل فني" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="300"><img src="https://imagizer.imageshack.com/img922/5889/8YPapb.jpg" alt="تصوير احترافي" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="400"><img src="https://imagizer.imageshack.com/img923/1641/XCOcQz.png" alt="فن بصري" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="500"><img src="https://imagizer.imageshack.com/img923/6105/zyeIf9.jpg" alt="تصميم جرافيك" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="550"><img src="https://imagizer.imageshack.com/img924/4230/dyYPPU.jpg" alt="تصميم إبداعي" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="600"><img src="https://imagizer.imageshack.com/img924/2280/56psLg.png" alt="إبداع فني" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="700"><img src="https://imagizer.imageshack.com/img922/2249/u8HFhr.jpg" alt="لوحة فنية" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="800"><img src="https://imagizer.imageshack.com/img923/4964/dWmp05.jpg" alt="فن تصويري" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="900"><img src="https://imagizer.imageshack.com/img923/9679/r2P937.png" alt="تصميم جرافيكي" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="1000"><img src="https://imagizer.imageshack.com/img923/5765/DfLAlA.jpg" alt="لوحة فنية" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="1100"><img src="https://imagizer.imageshack.com/img924/6291/dpaxGi.jpg" alt="تصميم جرافيكي" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="1200"><img src="https://imagizer.imageshack.com/img923/9674/Np64vR.jpg" alt="تصميم إبداعي" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="1300"><img src="https://imagizer.imageshack.com/img924/6587/urrLyW.png" alt="تصميم إبداعي" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="1400"><img src="https://imagizer.imageshack.com/img922/1403/FqKy4S.jpg" alt="تصميم إبداعي" loading="lazy"></div>
        </div>
        <button class="carousel-nav-btn prev-carousel-btn" aria-label="السابق"><i class="fas fa-chevron-right"></i></button> <button class="carousel-nav-btn next-carousel-btn" aria-label="التالي"><i class="fas fa-chevron-left"></i></button>  </div>

    <div class="section-divider" data-aos="fade-left" data-aos-offset="150">
        <span class="divider-line"></span>
        <h2 class="divider-title">لوجوهات مميزة</h2>
        <span class="divider-line"></span>
    </div>

    <div class="carousel-container logo-section">
        <div class="carousel-wrapper" id="logo-carousel">
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="100"><img src="https://imagizer.imageshack.com/img923/3629/xdL0C3.png" alt="لوجو شركة" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="200"><img src="https://imagizer.imageshack.com/img922/1505/n19fSr.png" alt="هوية بصرية" loading="lazy"></div>
        </div>
        <button class="carousel-nav-btn prev-carousel-btn" aria-label="السابق"><i class="fas fa-chevron-right"></i></button>
        <button class="carousel-nav-btn next-carousel-btn" aria-label="التالي"><i class="fas fa-chevron-left"></i></button>
    </div>

    <div class="section-divider" data-aos="fade-right" data-aos-offset="150">
        <span class="divider-line"></span>
        <h2 class="divider-title">إعلانات جذابة</h2>
        <span class="divider-line"></span>
    </div>

    <div class="carousel-container ads-section">
        <div class="carousel-wrapper" id="ads-carousel">
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="100"><img src="https://imagizer.imageshack.com/img923/2671/TpJi7G.png" alt="إعلان مبتكر" loading="lazy"></div>
            <div class="gallery-item" data-aos="zoom-in" data-aos-delay="200"><img src="https://imagizer.imageshack.com/img924/4301/98Pd8q.png" alt="تصميم إعلاني" loading="lazy"></div>
        </div>
        <button class="carousel-nav-btn prev-carousel-btn" aria-label="السابق"><i class="fas fa-chevron-right"></i></button>
        <button class="carousel-nav-btn next-carousel-btn" aria-label="التالي"><i class="fas fa-chevron-left"></i></button>
    </div>
</div>

<div class="lightbox">
    <div class="close-btn" aria-label="إغلاق المعرض">
        <i class="fas fa-times"></i>
    </div>
    <div class="nav-btn prev-btn" aria-label="الصورة السابقة">
        <i class="fas fa-chevron-right"></i> </div>
    <div class="lightbox-content">
        <img src="" alt="صورة مكبرة">
    </div>
    <div class="nav-btn next-btn" aria-label="الصورة التالية">
        <i class="fas fa-chevron-left"></i> </div>
    <div class="lightbox-spinner"></div> </div>

<button class="back-to-top" aria-label="العودة للأعلى">
    <i class="fas fa-chevron-up"></i>
</button>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        AOS.init({
            duration: 1000,
            once: true,
            mirror: false,
            offset: 200,
        });

        const preloader = document.getElementById('preloader');
        const allGalleryItems = document.querySelectorAll('.gallery-item');
        const lightbox = document.querySelector('.lightbox');
        const lightboxImg = document.querySelector('.lightbox-content img');
        const closeBtn = document.querySelector('.close-btn');
        const lightboxPrevBtn = document.querySelector('.lightbox .nav-btn.prev-btn');
        const lightboxNextBtn = document.querySelector('.lightbox .nav-btn.next-btn');
        const lightboxSpinner = document.querySelector('.lightbox-spinner'); // Added this element to HTML
        const backToTopBtn = document.querySelector('.back-to-top');

        let currentImageIndex = 0;
        let activeGalleryItems = [];

        // Essential element checks for robustness
        if (!lightbox || !lightboxImg || !closeBtn || !lightboxSpinner || !backToTopBtn) {
            console.error('One or more essential elements for the page or lightbox are missing. Please check your HTML structure.');
            return; // Stop script execution if critical elements are missing
        }

        let imagesLoaded = 0;
        const allPageImages = document.querySelectorAll('.gallery-item img');
        const totalImages = allPageImages.length;

        function imageLoadedCallback() {
            imagesLoaded++;
            if (imagesLoaded >= totalImages) {
                preloader.classList.add('hidden');
                document.body.style.overflow = 'auto'; // Allow scrolling after preloader hides
                initializeCarouselsCenter(); // Center carousels after content loads
            }
        }

        // Handle cases where there are no images or to ensure preloader hides
        if (totalImages === 0) {
            preloader.classList.add('hidden');
            document.body.style.overflow = 'auto';
            initializeCarouselsCenter();
        } else {
            document.body.style.overflow = 'hidden'; // Prevent scrolling while loading

            // Timeout to hide preloader even if some images fail to load
            const MAX_PRELOADER_DISPLAY_TIME = 3000; // 3 seconds
            setTimeout(() => {
                if (!preloader.classList.contains('hidden')) {
                    preloader.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                    console.warn('Preloader hidden due to timeout. Some images might still be loading.');
                    initializeCarouselsCenter();
                }
            }, MAX_PRELOADER_DISPLAY_TIME);

            allPageImages.forEach(img => {
                // Use a temporary image to trigger onload/onerror without changing actual DOM img
                const tempImg = new Image();
                tempImg.src = img.src;
                tempImg.onload = imageLoadedCallback;
                tempImg.onerror = imageLoadedCallback; // Crucial for cases where image fails
            });
        }

        // Lightbox functionality
        allGalleryItems.forEach((item) => {
            item.addEventListener('click', function() {
                // Determine which set of images to use for the lightbox based on the clicked carousel
                const parentWrapper = this.closest('.carousel-wrapper');
                activeGalleryItems = Array.from(parentWrapper.querySelectorAll('.gallery-item img'));

                const img = this.querySelector('img');
                if (img && img.src) {
                    currentImageIndex = activeGalleryItems.findIndex(image => image.src === img.src);
                    showLightboxImage(currentImageIndex);
                }
            });
        });

        function showLightboxImage(index) {
            if (index < 0 || index >= activeGalleryItems.length) {
                return;
            }

            currentImageIndex = index;
            const imageUrl = activeGalleryItems[currentImageIndex].src;
            const imageAlt = activeGalleryItems[currentImageIndex].alt || 'صورة مكبرة';

            lightboxSpinner.style.display = 'block'; // Show spinner
            lightboxImg.classList.add('loading'); // Add loading class for potential CSS effects
            lightboxImg.src = ''; // Clear previous image

            const newImage = new Image();
            newImage.src = imageUrl;
            newImage.onload = () => {
                lightboxImg.src = newImage.src;
                lightboxImg.alt = imageAlt;
                lightbox.classList.add('active'); // Show lightbox
                document.body.style.overflow = 'hidden'; // Prevent body scroll
                lightboxSpinner.style.display = 'none'; // Hide spinner
                lightboxImg.classList.remove('loading');
            };
            newImage.onerror = () => {
                console.error('Failed to load image in lightbox:', imageUrl);
                lightboxImg.src = 'https://via.placeholder.com/600x400?text=Image+failed+to+load'; // Fallback image
                lightboxImg.alt = 'تعذر تحميل الصورة';
                lightbox.classList.add('active');
                document.body.style.overflow = 'hidden';
                lightboxSpinner.style.display = 'none';
                lightboxImg.classList.remove('loading');
            };
        }

        function navigateLightbox(direction) {
            if (direction === 'prev') { // In RTL, 'prev' button means moving to an image that appears to the right
                currentImageIndex = (currentImageIndex - 1 + activeGalleryItems.length) % activeGalleryItems.length;
            } else if (direction === 'next') { // In RTL, 'next' button means moving to an image that appears to the left
                currentImageIndex = (currentImageIndex + 1) % activeGalleryItems.length;
            }
            showLightboxImage(currentImageIndex);
        }

        // Lightbox Navigation Buttons
        lightboxPrevBtn.addEventListener('click', () => navigateLightbox('prev'));
        lightboxNextBtn.addEventListener('click', () => navigateLightbox('next'));

        function closeLightbox() {
            lightbox.classList.remove('active');
            document.body.style.overflow = 'auto'; // Restore body scroll
            lightboxSpinner.style.display = 'none'; // Ensure spinner is hidden
            lightboxImg.classList.remove('loading');
        }

        closeBtn.addEventListener('click', closeLightbox);
        // Close lightbox if clicking on the semi-transparent background
        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox || e.target === lightboxImg.parentElement) {
                closeLightbox();
            }
        });

        // Keyboard navigation for lightbox
        document.addEventListener('keydown', (e) => {
            if (lightbox.classList.contains('active')) {
                if (e.key === 'Escape') {
                    closeLightbox();
                } else if (e.key === 'ArrowRight') { // Right arrow
                    navigateLightbox('prev'); // In RTL, right arrow means previous image
                } else if (e.key === 'ArrowLeft') { // Left arrow
                    navigateLightbox('next'); // In RTL, left arrow means next image
                }
            }
        });

        // Swipe functionality for Lightbox on touch devices
        let touchStartX = 0;
        let touchEndX = 0;

        lightbox.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });

        lightbox.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleGesture();
        }, { passive: true });

        function handleGesture() {
            const swipeThreshold = 50; // Minimum distance for a swipe

            if (Math.abs(touchEndX - touchStartX) < swipeThreshold) {
                return; // Not enough movement to be considered a swipe
            }

            if (touchEndX < touchStartX) { // Swiped left
                navigateLightbox('next'); // In RTL, swiping left goes to the next image
            } else if (touchEndX > touchStartX) { // Swiped right
                navigateLightbox('prev'); // In RTL, swiping right goes to the previous image
            }
        }


        // Back to Top button functionality
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });

        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Carousel drag/swipe functionality and active item logic
        document.querySelectorAll('.carousel-wrapper').forEach(wrapper => {
            let isDown = false;
            let startX;
            let scrollLeft;
            let lastScrollTime = 0;
            const scrollDebounceTime = 100; // milliseconds

            wrapper.addEventListener('mousedown', (e) => {
                isDown = true;
                wrapper.classList.add('active');
                startX = e.pageX - wrapper.offsetLeft;
                scrollLeft = wrapper.scrollLeft;
            });
            wrapper.addEventListener('mouseleave', () => {
                isDown = false;
                wrapper.classList.remove('active');
            });
            wrapper.addEventListener('mouseup', () => {
                isDown = false;
                wrapper.classList.remove('active');
            });
            wrapper.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - wrapper.offsetLeft;
                const walk = (x - startX) * 1.5; // Adjusted multiplier for smoother drag
                wrapper.scrollLeft = scrollLeft - walk;
            });

            // Touch events for mobile
            wrapper.addEventListener('touchstart', (e) => {
                isDown = true;
                startX = e.touches[0].pageX - wrapper.offsetLeft;
                scrollLeft = wrapper.scrollLeft;
            }, { passive: true }); // Use passive for better scroll performance
            wrapper.addEventListener('touchend', () => {
                isDown = false;
            }, { passive: true });
            wrapper.addEventListener('touchmove', (e) => {
                if (!isDown) return;
                const x = e.touches[0].pageX - wrapper.offsetLeft;
                const walk = (x - startX) * 1.5;
                wrapper.scrollLeft = scrollLeft - walk;
            }, { passive: true });

            // Logic to apply 'active-item' class based on visible center
            wrapper.addEventListener('scroll', () => {
                const now = Date.now();
                if (now - lastScrollTime < scrollDebounceTime) {
                    return; // Debounce scroll events
                }
                lastScrollTime = now;

                const items = Array.from(wrapper.children);
                if (items.length === 0) return;

                // Calculate the visual center of the *visible* part of the wrapper
                // In RTL, scrollLeft 0 is the far right. As you scroll left, scrollLeft increases.
                // The visible left edge is at scrollLeft. The visible right edge is at scrollLeft - wrapper.offsetWidth.
                // Or simply: the current scroll position relative to the content's origin (far left)
                const wrapperVisualCenter = (wrapper.scrollWidth - wrapper.offsetWidth) - wrapper.scrollLeft + (wrapper.offsetWidth / 2);

                items.forEach(item => {
                    const itemCenter = item.offsetLeft + (item.offsetWidth / 2);
                    const distance = Math.abs(itemCenter - wrapperVisualCenter);

                    if (distance < item.offsetWidth / 2) { // Item center is within half its width from wrapper's center
                        item.classList.add('active-item');
                    } else {
                        item.classList.remove('active-item');
                    }
                });
            });

            const container = wrapper.closest('.carousel-container');
            const prevBtn = container.querySelector('.prev-carousel-btn');
            const nextBtn = container.querySelector('.next-carousel-btn');

            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    const currentItemWidth = wrapper.querySelector('.gallery-item')?.offsetWidth || 320;
                    const gap = 25; // As defined in CSS
                    const scrollAmount = currentItemWidth + gap;
                    // For RTL, clicking 'prev' (which visually implies going right) actually decreases scrollLeft value
                    // because scrollLeft 0 is max right. So, to go "back" (right), decrease scrollLeft.
                    wrapper.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    const currentItemWidth = wrapper.querySelector('.gallery-item')?.offsetWidth || 320;
                    const gap = 25;
                    const scrollAmount = currentItemWidth + gap;
                    // For RTL, clicking 'next' (which visually implies going left) actually increases scrollLeft value
                    // because scrollLeft 0 is max right. So, to go "next" (left), increase scrollLeft.
                    wrapper.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                });
            }
        });

        // Function to center the carousels on page load/image load
        function initializeCarouselsCenter() {
            document.querySelectorAll('.carousel-wrapper').forEach(wrapper => {
                const items = Array.from(wrapper.children);
                if (items.length === 0) return;

                const wrapperWidth = wrapper.offsetWidth;
                const totalContentWidth = wrapper.scrollWidth;

                // For RTL, scrollLeft = 0 is the far right.
                // To center the content visually, we need to position the scrollbar at the midpoint
                // of the *available scrollable area*.
                // The maximum scrollLeft is `totalContentWidth - wrapperWidth`.
                // So, the scroll position for centering is half of that maximum scrollLeft.
                const centerScrollPosition = (totalContentWidth - wrapperWidth) / 2;

                // For RTL, we actually want to scroll *from the right* towards the *left* to center.
                // The `scrollLeft` property works by setting the distance from the *left edge of the content*
                // to the *left edge of the visible area*.
                // In RTL, the "start" is on the right.
                // So, if we want the middle of the content to be in the middle of the viewport:
                // Calculate the pixel position of the actual content center from its *leftmost* edge.
                // Then calculate the scrollLeft needed for that.
                // A simpler, more reliable way for RTL centering is often to use the total width
                // and subtract the viewport width, then divide by 2.
                // This gives us the point from the "logical start" (right in RTL) to scroll to.
                wrapper.scrollTo({ left: centerScrollPosition, behavior: 'instant' });

                // Dispatch scroll event to ensure 'active-item' class is applied immediately
                // Small timeout might be needed for rendering cycle
                setTimeout(() => {
                    wrapper.dispatchEvent(new Event('scroll'));
                }, 50);
            });
        }
    });
</script>
</body>
</html>
